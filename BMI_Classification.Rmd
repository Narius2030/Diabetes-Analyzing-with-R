---
title: "RandomForest"
output: html_notebook
date: "2023-11-15"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

Load dữ liệu và hiển thị các hàng đầu và kích thước tập dữ liệu

```{r}
setwd("C:/Education/Uni/Statistic with R/Final_Project/R-diabetes")
diabetes <- read.csv("diabetes.csv")
```


```{r cars}
head(diabetes)
str(diabetes)
```

## Classifying the categories of Mass (BMI)

The World Health Organization (WHO) classifies adults based on the following BMI ranges:

* Underweight: < 18.5 kg/m^2

* Normal weight: 18.5 - 24.9 kg/m^2

* Overweight: 25.0 - 29.9 kg/m^2

* Obese: ≥ 30.0 kg/m^2

```{r}
diabetes$BMI_Category <- cut(diabetes$BMI, 
                             breaks = c(-Inf, 18.5, 24.9, 29.9, Inf), 
                             labels = c("Underweight", "Normal", "Overweight", "Obese"))

```


Trực quan sự phân bố của loại cân nặng

```{r}
ggplot(diabetes, aes(x = BMI_Category)) + 
  geom_bar(stat = "count") +
  labs(title = "Distribution of BMI Categories", x = "BMI Category", y = "Count") +
  theme_bw()

```


Chuyển đổi các giá trị BMI_Category thành factors

```{r}
diabetes$BMI_Category<- as.factor(diabetes$BMI_Category)

str(diabetes)
```

Tạo một dataframe bản sao với BMI_Category đã được số hóa

```{r}
num_diabetes <- diabetes

num_diabetes$BMI_Category <- cut(num_diabetes$BMI, 
                             breaks = c(-Inf, 18.5, 24.9, 29.9, Inf), 
                             labels = c(0, 1, 2, 3))
num_diabetes$BMI_Category <- as.integer(num_diabetes$BMI_Category)
```


Tìm các biến độc lập so với biến phụ thuộc BMI_Category

```{r}
library(lattice)
library(reshape2)

# creating correlation matrix
corr_mat <- round(cor(num_diabetes),2)
 
# reduce the size of correlation matrix
melted_corr_mat <- melt(corr_mat)
# head(melted_corr_mat)
 
# plotting the correlation heatmap
library(ggplot2)
ggplot(data = melted_corr_mat, aes(x=Var1, y=Var2, fill=value)) + geom_tile() +
  geom_text(aes(Var2, Var1, label = value), color = "white", size = 4)
```
Ta có thể thấy:

* So với BMI_Category, các thuộc tính BMI, Insulin, SkinThickness, BloodPressure và Glucose đều tương quan mạnh (5 thuộc tính)

* Vậy thuộc tính BMI_Category sẽ phụ thuộc nhiều vào chúng, ta có thể xem chúng là các biến độc lập


Chia dữ liệu thành huấn luyện và kiểm tra. 80% dành cho đào tạo, 20% dành cho kiểm tra.

```{r}
set.seed(123)

samp <- sample(nrow(diabetes), 0.8 * nrow(diabetes))

train <- diabetes[samp, ]

test <- diabetes[-samp, ]
```


Kiểm tra kích thước của tập dữ liệu huấn luyện và kiểm tra:

```{r}
dim(test) 
```

Random forest library

```{r}
library(randomForest) 
```


Bây giờ chúng ta đã cài đặt xong thư viện RandomForest, chúng ta hãy xây dựng mô hình rừng ngẫu nhiên

```{r}
model <- randomForest(BMI_Category ~ . - Outcome, data = train, ntree = 1000, mtry = 3)

model
```

Bước tiếp theo là xác thực mô hình của chúng tôi bằng cách sử dụng dữ liệu thử nghiệm

```{r}
prediction <- predict(model, newdata = test)

table(prediction, test$BMI_Category)

prediction
```

Bây giờ, hiển thị giá trị dự đoán so với giá trị thực tế

```{r}
results<-cbind(prediction,test$BMI_Category)

results

colnames(results)<-c('pred','real')

results<-as.data.frame(results)

View(results)
```


Cuối cùng, tính độ chính xác của mô hình

```{r}

sum(prediction==test$BMI_Category) / nrow(test) # The output is as shown below

```

Bạn có thể thấy rằng độ chính xác của mô hình này là 98 phần trăm, điều này thật tuyệt vời. Bây giờ chúng tôi đã tự động hóa quá trình dự đoán loại cân nặng. Điều này đưa chúng ta đến khả năng theo dõi tình trạng sức khỏa của bệnh nhân và đưa ra chuẩn đoán sớm
